Task 19 Рђћ Deployment Script


рЃАрЃЎрЃарЃўрЃърЃбрЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃљ:
```bash
nano ~/docker-app/deploy.sh
```

```bash
#!/bin/bash
set -euo pipefail

# ==============================
# CONFIG
# ==============================

APP_DIR="$HOME/docker-app"
LOG_FILE="$APP_DIR/deploy.log"

DATE=$(date "+%Y-%m-%d %H:%M:%S")

# Colors
RED="\033[0;31m"
GREEN="\033[0;32m"
YELLOW="\033[1;33m"
NC="\033[0m"

# ==============================
# FUNCTIONS
# ==============================

log() {
    local msg="$1"
    local file_msg="$2"

    echo -e "[$DATE] $msg"
    echo "[$DATE] $file_msg" >> "$LOG_FILE"
}

fail() {
    log "${RED}[ERROR]${NC} $1" "FAILED: $1"
    exit 1
}

# ==============================
# START
# ==============================

mkdir -p "$APP_DIR"
touch "$LOG_FILE"

cd "$APP_DIR" || fail "рЃЋрЃћрЃа рЃерЃћрЃЋрЃћрЃЊрЃў APP_DIR-рЃерЃў"

log "${YELLOW}=== DEPLOY STARTED ===${NC}" "DEPLOY START"

# ==============================
# STEP 1: GIT PULL
# ==============================

log "${YELLOW}[1/4]${NC} Git pull..." "START: git pull"

if git remote | grep -q .; then
    git pull >> "$LOG_FILE" 2>&1 || fail "git pull рЃЕрЃљрЃЋрЃљрЃарЃЊрЃљ"
else
    log "${YELLOW}[SKIP]${NC} Git remote рЃљрЃа рЃљрЃарЃўрЃА" "SKIP: no remote"
fi

log "${GREEN}[OK]${NC} рЃЎрЃЮрЃЊрЃў рЃњрЃљрЃюрЃљрЃ«рЃџрЃЊрЃљ" "SUCCESS: git pull"

# ==============================
# STEP 2: STOP CONTAINERS
# ==============================

log "${YELLOW}[2/4]${NC} Containers stopping..." "START: docker down"

docker compose down >> "$LOG_FILE" 2>&1 || fail "docker down рЃЕрЃљрЃЋрЃљрЃарЃЊрЃљ"

log "${GREEN}[OK]${NC} рЃњрЃљрЃЕрЃћрЃарЃЊрЃљ" "SUCCESS: containers stopped"

# ==============================
# STEP 3: BUILD / PULL
# ==============================

log "${YELLOW}[3/4]${NC} Pull & Build..." "START: build"

docker compose pull >> "$LOG_FILE" 2>&1 || fail "docker pull рЃЕрЃљрЃЋрЃљрЃарЃЊрЃљ"
docker compose build --no-cache >> "$LOG_FILE" 2>&1 || fail "docker build рЃЕрЃљрЃЋрЃљрЃарЃЊрЃљ"

log "${GREEN}[OK]${NC} Build рЃЊрЃљрЃАрЃарЃБрЃџрЃЊрЃљ" "SUCCESS: build complete"

# ==============================
# STEP 4: START
# ==============================

log "${YELLOW}[4/4]${NC} Starting containers..." "START: docker up"

docker compose up -d >> "$LOG_FILE" 2>&1 || fail "docker up рЃЕрЃљрЃЋрЃљрЃарЃЊрЃљ"

log "${GREEN}[OK]${NC} рЃњрЃљрЃћрЃерЃЋрЃљ" "SUCCESS: containers started"

# ==============================
# STATUS
# ==============================

echo ""
echo "=========================================="
echo " Container Status"
echo "=========================================="
docker compose ps
echo ""

# ==============================
# DONE
# ==============================

log "${GREEN}=== DEPLOY FINISHED ===${NC}" "DEPLOY SUCCESS"

echo "=========================================="
echo -e " ${GREEN}DEPLOY COMPLETE${NC} Рђћ $DATE"
echo "=========================================="

```
## рЃАрЃЎрЃарЃўрЃърЃбрЃўрЃА рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃћрЃџрЃћрЃЏрЃћрЃюрЃбрЃћрЃЉрЃў

### `set -euo pipefail`

| рЃцрЃџрЃљрЃњрЃў | рЃЊрЃљрЃюрЃўрЃерЃюрЃБрЃџрЃћрЃЉрЃљ |
|-------|-------------|
| `-e` | рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃарЃў рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃерЃћрЃфрЃЊрЃЮрЃЏрЃўрЃАрЃљрЃА рЃАрЃЎрЃарЃўрЃърЃбрЃў рЃЕрЃћрЃарЃЊрЃћрЃЉрЃљ |
| `-u` | рЃњрЃљрЃюрЃБрЃАрЃљрЃќрЃдрЃЋрЃарЃћрЃџрЃў рЃфрЃЋрЃџрЃљрЃЊрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃАрЃљрЃА рЃерЃћрЃфрЃЊрЃЮрЃЏрЃљ |
| `-o pipefail` | pipe-рЃерЃў (`\|`) рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃарЃў рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃерЃћрЃфрЃЊрЃЮрЃЏрЃљ рЃњрЃљрЃЊрЃљрЃћрЃфрЃћрЃЏрЃљ |

рЃћрЃА рЃАрЃљрЃЏрЃћрЃБрЃџрЃў Bash рЃАрЃЎрЃарЃўрЃърЃбрЃћрЃЉрЃўрЃА РђърЃБрЃАрЃљрЃцрЃарЃЌрЃ«рЃЮрЃћрЃЉрЃўрЃА рЃЦрЃљрЃЏрЃљрЃарЃўрЃљ" Рђћ рЃ«рЃћрЃџрЃА рЃБрЃерЃџрЃўрЃА рЃЕрЃБрЃЏрЃљрЃЊ рЃЕрЃљрЃЋрЃљрЃарЃЊрЃюрЃўрЃџ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃћрЃЉрЃА.

### `fail()` рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ

```bash
fail() {
    log "${RED}[ERROR]${NC} $1" "FAILED: $1"
    exit 1
}
```

рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃа рЃюрЃљрЃЉрЃўрЃ»рЃерЃў `|| fail "..."` pattern-рЃўрЃЌ рЃњрЃљрЃЏрЃЮрЃўрЃДрЃћрЃюрЃћрЃЉрЃљ. рЃЌрЃБ рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ рЃЕрЃљрЃЋрЃљрЃарЃЊрЃљ Рђћ рЃџрЃЮрЃњрЃерЃў рЃЕрЃљрЃўрЃгрЃћрЃарЃћрЃЉрЃљ, рЃбрЃћрЃарЃЏрЃўрЃюрЃљрЃџрЃерЃў рЃерЃћрЃфрЃЊрЃЮрЃЏрЃљ рЃњрЃљрЃЏрЃЮрЃЕрЃюрЃЊрЃћрЃЉрЃљ, рЃАрЃЎрЃарЃўрЃърЃбрЃў рЃерЃћрЃЕрЃћрЃарЃЊрЃћрЃЉрЃљ.



### рЃџрЃЮрЃњрЃўрЃарЃћрЃЉрЃљ

рЃАрЃЎрЃарЃўрЃърЃбрЃў рЃЮрЃарЃљрЃЊрЃњрЃўрЃџрЃљрЃА рЃгрЃћрЃарЃА output-рЃА: рЃбрЃћрЃарЃЏрЃўрЃюрЃљрЃџрЃерЃў рЃцрЃћрЃарЃљрЃЊрЃў рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃћрЃЉрЃўрЃЌ, рЃЊрЃљ `deploy.log` рЃцрЃљрЃўрЃџрЃерЃў timestamp-рЃўрЃљрЃюрЃў рЃЕрЃљрЃюрЃљрЃгрЃћрЃарЃћрЃЉрЃўрЃЌ. `>> "$LOG_FILE" 2>&1` Рђћ stdout рЃЊрЃљ stderr рЃЮрЃарЃўрЃЋрЃћ рЃџрЃЮрЃњ рЃцрЃљрЃўрЃџрЃерЃў рЃЏрЃўрЃЊрЃўрЃА.

рЃАрЃЎрЃарЃўрЃърЃбрЃў рЃарЃЮрЃЏ рЃњрЃљрЃ«рЃЊрЃћрЃА рЃњрЃљрЃерЃЋрЃћрЃЉрЃљрЃЊрЃў:
```bash
chmod +x ~/docker-app/deploy.sh
```

Git-рЃерЃў рЃЊрЃљрЃљрЃЏрЃљрЃбрЃћ:
```bash
cd ~/docker-app
git add deploy.sh
git commit -m "Add deployment script"
```


```console
k@devserver:~/docker-app$ nano ~/docker-app/deploy.sh
k@devserver:~/docker-app$ chmod +x ~/docker-app/deploy.sh
k@devserver:~/docker-app$ cd ~/docker-app
k@devserver:~/docker-app$ git add deploy.sh
k@devserver:~/docker-app$ git commit -m "Add deployment script"
[master 7b45374] Add deployment script
 1 file changed, 77 insertions(+)
 create mode 100755 deploy.sh
k@devserver:~/docker-app$ ~/docker-app/deploy.sh
==========================================
 Deploy Started Рђћ 2026-02-10 19:53:25
==========================================
[1/4] Git pull...
k@devserver:~/docker-app$
```


## рЃАрЃЎрЃарЃўрЃърЃбрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃљ

```bash
./deploy.sh
```

```console
k@devserver:~/docker-app$ chmod +x deploy.sh
k@devserver:~/docker-app$ ./deploy.sh
[2026-02-10 20:09:57] === DEPLOY STARTED ===
[2026-02-10 20:09:57] [1/4] Git pull...
[2026-02-10 20:09:57] [SKIP] Git remote рЃљрЃа рЃљрЃарЃўрЃА
[2026-02-10 20:09:57] [OK] рЃЎрЃЮрЃЊрЃў рЃњрЃљрЃюрЃљрЃ«рЃџрЃЊрЃљ
[2026-02-10 20:09:57] [2/4] Containers stopping...
[2026-02-10 20:09:57] [OK] рЃњрЃљрЃЕрЃћрЃарЃЊрЃљ
[2026-02-10 20:09:57] [3/4] Pull & Build...
[2026-02-10 20:09:57] [OK] Build рЃЊрЃљрЃАрЃарЃБрЃџрЃЊрЃљ
[2026-02-10 20:09:57] [4/4] Starting containers...
[2026-02-10 20:09:57] [OK] рЃњрЃљрЃћрЃерЃЋрЃљ

==========================================
 Container Status
==========================================
NAME                   IMAGE                COMMAND                  SERVICE   CREATED          STATUS                    PORTS
docker-app-adminer-1   adminer:latest       "entrypoint.sh dockeРђд"   adminer   15 seconds ago   Up 7 seconds              0.0.0.0:8081->8080/tcp, [::]:8081->8080/tcp
docker-app-db-1        postgres:16-alpine   "docker-entrypoint.sРђд"   db        17 seconds ago   Up 10 seconds (healthy)   5432/tcp
docker-app-web-1       nginx:alpine         "/docker-entrypoint.Рђд"   web       15 seconds ago   Up 2 seconds              0.0.0.0:8080->80/tcp, [::]:8080->80/tcp

[2026-02-10 20:09:57] === DEPLOY FINISHED ===
==========================================
 DEPLOY COMPLETE Рђћ 2026-02-10 20:09:57
==========================================
k@devserver:~/docker-app$
```

## рЃџрЃЮрЃњрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃљ:
```bash
~/docker-app/deploy.log
```

рЃерЃћрЃњрЃўрЃФрЃџрЃўрЃљ рЃюрЃљрЃ«рЃЮ:
```bash
tail -f ~/docker-app/deploy.log
```

> ­ЪњА `tail -f` real-time-рЃерЃў рЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃА рЃџрЃЮрЃњрЃА. рЃљрЃ«рЃљрЃџрЃў deploy-рЃўрЃА рЃЊрЃарЃЮрЃА рЃЏрЃћрЃЮрЃарЃћ рЃбрЃћрЃарЃЏрЃўрЃюрЃљрЃџрЃерЃў рЃњрЃљрЃБрЃерЃЋрЃўрЃЌ рЃЊрЃљ рЃЏрЃЌрЃћрЃџрЃў рЃърЃарЃЮрЃфрЃћрЃАрЃў рЃфрЃЮрЃфрЃ«рЃџрЃљрЃЊ рЃЊрЃљрЃўрЃюрЃљрЃ«рЃљрЃЋрЃЌ.

```console
k@devserver:~/docker-app$ tail -f ~/docker-app/deploy.log
 Container docker-app-db-1 Starting
 Container docker-app-db-1 Started
 Container docker-app-db-1 Waiting
 Container docker-app-adminer-1 Starting
 Container docker-app-adminer-1 Started
 Container docker-app-db-1 Healthy
 Container docker-app-web-1 Starting
 Container docker-app-web-1 Started
[2026-02-10 20:09:57] SUCCESS: containers started
[2026-02-10 20:09:57] DEPLOY SUCCESS
```


## рЃерЃћрЃЊрЃћрЃњрЃћрЃЉрЃў

### Deploy рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃўрЃќрЃљрЃфрЃўрЃљ

рЃ«рЃћрЃџрЃўрЃЌ deploy-рЃўрЃА рЃЊрЃарЃЮрЃА рЃДрЃЮрЃЋрЃћрЃџ рЃ»рЃћрЃарЃќрЃћ 5-6 рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃўрЃА рЃЌрЃљрЃюрЃЏрЃўрЃЏрЃЊрЃћрЃЋрЃарЃЮрЃЉрЃўрЃЌ рЃљрЃЎрЃарЃћрЃцрЃљ рЃЊрЃљрЃБрЃерЃЋрЃћрЃЉрЃћрЃџрЃўрЃљ Рђћ рЃљрЃЊрЃЋрЃўрЃџрЃўрЃљ рЃарЃЮрЃЏрЃћрЃџрЃўрЃЏрЃћ рЃњрЃљрЃЏрЃЮрЃбрЃЮрЃЋрЃЮ рЃљрЃю рЃљрЃарЃљрЃАрЃгрЃЮрЃарЃў рЃЌрЃљрЃюрЃЏрЃўрЃЏрЃЊрЃћрЃЋрЃарЃЮрЃЉрЃўрЃЌ рЃњрЃљрЃБрЃерЃЋрЃљ. рЃАрЃЎрЃарЃўрЃърЃбрЃў рЃљрЃЏ рЃърЃарЃЮрЃфрЃћрЃАрЃА рЃАрЃбрЃљрЃюрЃЊрЃљрЃарЃбрЃўрЃќрЃћрЃЉрЃБрЃџрЃА рЃЊрЃљ рЃњрЃљрЃюрЃЏрЃћрЃЮрЃарЃћрЃЉрЃљрЃЊрЃА рЃ«рЃЊрЃўрЃА.

### Error Handling pattern

`command || fail "message"` Рђћ Bash-рЃўрЃА рЃўрЃЊрЃўрЃЮрЃЏрЃљрЃбрЃБрЃарЃў pattern. рЃюрЃўрЃерЃюрЃљрЃЋрЃА: РђърЃњрЃљрЃБрЃерЃЋрЃў рЃЉрЃарЃФрЃљрЃюрЃћрЃЉрЃљ, рЃЌрЃБ рЃЕрЃљрЃЋрЃљрЃарЃЊрЃљ Рђћ fail рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃњрЃљрЃЏрЃЮрЃўрЃФрЃљрЃ«рЃћ." `set -e`-рЃАрЃЌрЃљрЃю рЃћрЃарЃЌрЃљрЃЊ рЃћрЃА рЃЮрЃарЃЏрЃљрЃњ рЃЊрЃљрЃфрЃЋрЃљрЃА рЃўрЃФрЃџрЃћрЃЋрЃљ.

### рЃърЃўрЃарЃЋрЃћрЃџрЃў vs рЃњрЃљрЃБрЃЏрЃ»рЃЮрЃЉрЃћрЃАрЃћрЃЉрЃБрЃџрЃў рЃЋрЃћрЃарЃАрЃўрЃљ

рЃърЃўрЃарЃЋрЃћрЃџрЃў рЃЋрЃћрЃарЃАрЃўрЃљ рЃЕрЃљрЃЋрЃљрЃарЃЊрЃљ рЃўрЃЏрЃўрЃбрЃЮрЃЏ рЃарЃЮрЃЏ `git pull` remote-рЃўрЃА рЃњрЃљрЃарЃћрЃерЃћ error-рЃА рЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃА рЃЊрЃљ `set -e` рЃАрЃЎрЃарЃўрЃърЃбрЃА рЃљрЃЕрЃћрЃарЃћрЃЉрЃА. рЃћрЃА рЃбрЃўрЃърЃўрЃБрЃарЃў рЃАрЃўрЃбрЃБрЃљрЃфрЃўрЃљрЃљ Рђћ рЃАрЃЎрЃарЃўрЃърЃбрЃў рЃДрЃЮрЃЋрЃћрЃџрЃЌрЃЋрЃўрЃА РђърЃЉрЃћрЃЊрЃюрЃўрЃћрЃа рЃњрЃќрЃљрЃА" рЃЋрЃћрЃа рЃњрЃљрЃўрЃЋрЃџрЃўрЃА. рЃњрЃљрЃБрЃЏрЃ»рЃЮрЃЉрЃћрЃАрЃћрЃЉрЃБрЃџ рЃЋрЃћрЃарЃАрЃўрЃљрЃерЃў defensive programming-рЃўрЃЌ (рЃгрЃўрЃюрЃљрЃАрЃгрЃљрЃарЃў рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃћрЃЉрЃўрЃЌ) рЃљрЃАрЃћрЃЌрЃў edge case-рЃћрЃЉрЃў рЃАрЃгрЃЮрЃарЃљрЃЊ рЃЏрЃБрЃерЃљрЃЋрЃЊрЃћрЃЉрЃљ.